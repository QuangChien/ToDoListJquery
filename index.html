<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>To Do List With Jquery</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container">
    <header class="header">
        <h1>todos</h1>
    </header>
    <section class="main">
        <input class="new-todo" placeholder="What needs to be done?" value="">
        <div class="toggle-wrap">
            <label name="toggle-all-label" for="toggle-all">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>

            </label>
            <input class="toggle-all" id="toggle-all" type="checkbox" value="">
        </div>
        <ul class="todo-list"></ul>
    </section>
    <br>
    <footer class="footer">
        <span class="todo-count">
            <strong class="total-todo-active">0</strong>
            <span>items</span>
            <span>left</span>
        </span>
        <ul class="filters">
            <li class="active all selected">All</li>
            <li class="selected to-do-active"><span class="">Active</span></li>
            <li class="selected to-do-completed">Completed</li>
        </ul>
        <button class="clear-completed">Clear completed</button>
    </footer>
</div>
<script src="js/jquery.js"></script>
<script>
    $(document).ready(function () {
        selectState();
        addTodoItem();
        checkboxAllAction();
        destroyTodoItem();
        selectToDoItem();
        editTodoItem();
        deleteToDoListCompleted();
        isShowFooter();

        function isShowFooter(){
            if($(".view").length) {
                $('.footer').show();
            }else{
                $('.footer').hide();
            }
        }

        function updateTotalTodoListActive(){
            $('.total-todo-active').text($('.view:has(.active)').length);
        }

        function deleteToDoListCompleted() {
            $(".clear-completed").click(function () {
                $(".view:has(.completed)").remove();
                isShowFooter();
            })
        }

        function checkboxAllAction() {
            $(".toggle-all").click(function () {
                if ($('.toggle-all').is(':checked')) {
                    $(".toggle").each(function () {
                        this.checked = true;
                        $(this).next().css('text-decoration', 'line-through');
                        $(this).next().addClass('completed');
                        $(this).next().removeClass('active');
                        $('.total-todo-active').text('0');
                    });
                } else {
                    $(".toggle").each(function () {
                        this.checked = false;
                        $(this).next().css('text-decoration', 'unset');
                        $(this).next().removeClass('completed');
                        $(this).next().addClass('active');
                        updateTotalTodoListActive();
                    });
                }
            });
        }

        function addTodoItem() {
            $(".new-todo").keypress(function (e) {
                if (e.which == 13 && $(this).val().length > 0) {
                    $('.todo-list').append(`<li class="view">

                        <input class="toggle" type="checkbox" ${$('.toggle-all').is(':checked') || $(".to-do-completed.active").length ? 'checked' : ''}>
                        <input class="edit ${$('.toggle-all').is(':checked') || $(".to-do-completed.active").length ? 'completed line-through' : 'active'}" value="${$(this).val()}" disabled>
                        <button class="destroy">X</button>
                    </li>`);
                    updateTotalTodoListActive();
                    $(this).val('');
                    isShowFooter();
                }
            });
        }

        function destroyTodoItem() {
            $(document).on('click', '.destroy', function () {
                $(this).parent().remove();
                $('.total-todo-active').text($('.view').length);
                updateTotalTodoListActive();
                isShowFooter();
            })
        }

        function selectToDoItem() {
            $(document).on('click', '.toggle', function () {
                if($(".all.active").length) {
                    if ($(this).is(':checked')) {
                        $(this).next().css('text-decoration', 'line-through');
                        $(this).next().addClass('completed');
                        $(this).next().removeClass('active');
                    } else {
                        $(this).next().removeClass('completed');
                        $(this).next().addClass('active');
                        $(this).next().css('text-decoration', 'unset');
                    }
                }
                if($(".to-do-active.active").length){
                    $(this).next().addClass('completed');
                    $(this).next().removeClass('active');
                    $(this).parent().hide();
                }

                if($(".to-do-completed.active").length) {
                    $(this).next().addClass('active');
                    $(this).next().removeClass('completed');
                    $(this).parent().hide();
                }
                updateTotalTodoListActive();
            })
        }

        function editTodoItem() {
            $(document).on('dblclick', '.view:has(.edit)', function (e) {
                $(this).find('.edit').removeAttr("disabled");
                $(this).find('.edit').css('text-decoration', 'unset');
                $(this).find('.edit').focus();
            })

            $(document).on('focusout', '.view:has(.edit)', function () {
                $(this).find('.edit').attr('disabled', false)
            })

            $(document).on('blur', '.view:has(.edit)', function (e) {
                $(this).find('.edit').attr('disabled', 'disabled');
                if ($(this).find('.edit').val().length == 0) {
                    $(this).remove();
                    isShowFooter();
                }
                if ($(this).find('.edit').hasClass("completed")) {
                    $(this).find('.edit').css('text-decoration', 'line-through');
                }
            })
        }

        function selectState() {
            //click to do list active button
            $(".to-do-active").click(function () {
                $('.filters').children().removeClass('active');
                $(this).addClass('active');
                $(".view:has(.completed)").hide();
                $(".view:has(.active)").show();
                // $(".toggle-all").checked = false;
                // $(".toggle-all").attr("disabled", true);
            })

            //click to do list completed button
            $(".to-do-completed").click(function () {
                $('.filters').children().removeClass('active');
                $(this).addClass('active');
                $(".view:has(.active)").hide();
                $(".view:has(.completed)").show();
                // $(".toggle-all").hide();
                $(".toggle-all").checked = false;
            })

            //click to do list all button
            $(".all").click(function () {
                $('.filters').children().removeClass('active');
                $(this).addClass('active');
                $(".view").show();
                $(".toggle-all").show();
            })
        }
    });

</script>
</body>
</html>
